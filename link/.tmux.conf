###############################################################################
# Basic setup
###############################################################################

# unbind some default keybindings
unbind C-b

# set prefix key to Ctrl-a (default is Ctrl-t)
set -g prefix C-a

# Turn on 256 color support in tmux
#if-shell '[[ $TERM == "linux" ]]' 'set -g default-terminal "screen-256color"' 'set -g default-terminal "linux"'
set -g default-terminal "screen-256color"

# Use utf8
set -g utf8 on
setw -g utf8 on

###############################################################################
# Keybindings
###############################################################################

### Session management
# Pass through a ctrl-a if you press it twice
bind C-a send-prefix

# Set C-a q to kill session
bind q kill-session

# Reduce the 'timeout' after each instance of a repeatable action, like
# resizing or moving between windows.
#
# Default is 500.
set -g repeat-time 250

### Navigation
# Navigate using Vim-style keys
setw -g mode-keys vi
setw -g status-keys vi

# Pressing up or down toggles maximization of pane
bind Up resize-pane -Z
bind Down resize-pane -Z

# Pressing left and right rotates through panes in a window
bind -r Left rotate-window -D
bind -r Right rotate-window -U

# vim / xmonad style bindings for pane movement
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# Vim / xmonad style bindings for window movement
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Window navigation
bind -r n next-window
bind -r m previous-window

### Window and pane management
# better mnemonics for splitting panes!
bind | split-window -h -c '#{pane_current_path}'
bind - split-window -v -c '#{pane_current_path}'

# new windows start in cwd, the next window index up from the current window
bind c new-window -c '#{pane_current_path}' -a

# shift-movement keys will resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Carats swap panes
# -D = next
bind > swap-pane -D
# -U = previous
bind < swap-pane -U

### Text selection
# copy/paste using Vim-style keys
bind Escape copy-mode
unbind p
bind b list-buffers
bind p paste-buffer
bind P choose-buffer
bind -t vi-copy 'v' begin-selection
bind -t vi-copy 'y' copy-selection

# xclip support (commented as this often doesn't make sense on remote servers)
#bind C-c run "tmux save-buffer - / xclip -i -sel clipboard"
#bind C-v run "tmux set-buffer \"$(xclip -o -sel clipboard)\"; tmux paste-buffer"

# set up alias for turning on logging
bind P pipe-pane -o "cat >>~/#W.log" \; display "Toggled logging to ~/#W.log"
# bind r to reloading the config file
bind r source-file ~/.tmux.conf \; display "Reloaded tmux config file."

###############################################################################
# Cosmetics
###############################################################################

### Title display
# Set title to something descriptive of the entire sessions
set-option -g set-titles on

# window number, program name, active vel non
set-option -g set-titles-string '#H:#S.#I.#P #W #T'

### Windows
# fiddle with colors of inactive windows
setw -g window-status-style fg=colour244,bg=default,dim

# change color of active window
setw -g window-status-current-style fg=colour166,bg=default,bright

### Panes
# set color of regular and active panes
set -g pane-border-style fg=colour235
set -g pane-active-border-style fg=colour240
set -g display-panes-active-colour colour33
set -g display-panes-colour colour166

### Clock
setw -g clock-mode-colour colour64

### Command line
# set color of command line
set -g message-style fg=colour166,bg=colour235

### Status bar
# fiddle with colors of status bar
set -g status-style fg=colour136,bg=colour235

# configure contents of status bar
set -g status-utf8 on
set -g status-interval 2
set -g status-left-length 24
set -g status-left "#[fg=colour136,dim]#S"
set -g status-right "#[fg=colour136,dim] #h | %d %b %R"

# Place windows status on left of status bar
set -g status-justify centre

###############################################################################
# Miscellaneous
###############################################################################

# disable mouse support (at least while we're learning)
setw -g mode-mouse off
set -g mouse-select-pane off
set -g mouse-resize-pane off
set -g mouse-select-window off

# If a bell is used in any of the attached sessions, trigger a
# bell in the current window
set-option -g bell-action any

# Aggressive-resize makes it so that tmux only resizes windows
# in larger clients when smaller clients are actually looking at it
setw -g aggressive-resize on

# Enlarge console history
set -g history-limit 100000

# lower command delay
set -sg escape-time 0

# start first window and pane at 1, not zero
set -g base-index 1
set -g pane-base-index 1

# Windows with activity are highlighted in status line.
setw -g monitor-activity on

# If on, display a status line message when activity occurs in a
# window for which monitor-activity is enabled.
set -g visual-activity off

###############################################################################
# Local setup
###############################################################################

# Load local configuration
source ~/.tmux.conf.local
